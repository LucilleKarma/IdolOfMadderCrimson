Repository description gives the gist. Apologies in advance for the somewhat messy code in certain places.
